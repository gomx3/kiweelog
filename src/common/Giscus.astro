---
const { repo, repoId, category, categoryId } = Astro.props
---

<div id="giscus-container"></div>

<script define:vars={{ repo, repoId, category, categoryId }}>
    let giscusTheme = 'noborder_light'

    if (document.documentElement.classList.contains('dark')) {
        giscusTheme = 'noborder_dark'
    }

    const script = document.createElement('script')
    script.src = 'https://giscus.app/client.js'
    script.async = true
    script.crossOrigin = 'anonymous'
    script.setAttribute('data-repo', repo)
    script.setAttribute('data-repo-id', repoId)
    script.setAttribute('data-category', category)
    script.setAttribute('data-category-id', categoryId)
    script.setAttribute('data-mapping', 'pathname')
    script.setAttribute('data-strict', '0')
    script.setAttribute('data-reactions-enabled', '1')
    script.setAttribute('data-emit-metadata', '0')
    script.setAttribute('data-input-position', 'top')
    script.setAttribute('data-lang', 'ko')
    script.setAttribute('data-theme', giscusTheme)

    document.getElementById('giscus-container').appendChild(script)

    window.addEventListener('theme-change', (e) => {
        const newTheme = e.detail.theme
        const giscusFrame = document.querySelector('iframe.giscus-frame')
        if (giscusFrame && giscusFrame.contentWindow) {
            giscusFrame.contentWindow.postMessage(
                { giscus: { setConfig: { theme: `noborder_${newTheme}` } } },
                'https://giscus.app'
            )
        }
    })
</script>
